---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---


## Loading and preprocessing the data

Under the assumption that the target file is in the local
directory where the script is running the following code 
loads it into memory:

```{r: load the data, echo=TRUE}
defaultFileName <- "activity.csv"
if( !file.exists( file.path(defaultFileName))) {
    defaultFileName <- unzip( zipfile="activity.zip" )  
}
loaded_data <- suppressWarnings(read.csv(file = defaultFileName, 
                                 header=TRUE,
                                 quote='"',
                                 stringsAsFactors=FALSE,
                                 encoding="UTF-8"))
rm(defaultFileName)
```
The result is a data frame called `loaded_data`:

```{r: loaded data frame str, echo=FALSE}
str(loaded_data)
```
A few of the first, last, and some intermediate rows look as follows:
```{r: first and last rows, echo=FALSE}
head(loaded_data,n=3)
loaded_data[12308:12310,]
tail(loaded_data,n=3)
```
Before proceeding it is a good idea to transform the dates from strings 
into date format.
```{r: dates from strings to real date format, echo=TRUE}
clean_data <- loaded_data
clean_data$date <- as.Date(x= clean_data$date,format="%Y-%m-%d")
str(clean_data)
```

## What is mean total number of steps taken per day?

First a histogram of steps per day was generated with ggplot
`geom_bar`:

```{r:plot steps per day, cache=TRUE,echo=FALSE,fig.height=4,message=TRUE}
require(ggplot2)
## The data is already in the long format so ggplot can be used to generate the
## histogram
ggplot(data=clean_data, aes(x=date,y=steps)) +
    geom_bar(stat="identity") +
    labs(title="Number of steps per day") +
    labs(x= "Date", y= "Number of steps") 
```

Then the mean and median of the average number of steps per day
was computed from a transformation of the `steps`vector
of the `clean_data` data frame using the `mean` function
and the common date for each entry as the criterion for filtering
using the R function `tapply`.

```{r: compute steps per day,cache=FALSE, echo=TRUE}
count_steps_per_day <-tapply(X=clean_data$steps,INDEX=clean_data$date,sum)
```
Finally the mean and median of the steps per day are computed:

```{r: compute stats for steps per day,cache=FALSE,echo=TRUE,echo=TRUE}
mean_steps_per_day <- mean(count_steps_per_day, na.rm=TRUE)
median_steps_per_day <- median(count_steps_per_day, na.rm=TRUE)
```
The values are as follows:

```{r: print stats steps per day, cache=FALSE,echo=FALSE}
options(digits=2)
paste( "Mean steps per day  = " , mean_steps_per_day )
paste( "Median steps per day = ", median_steps_per_day )
# avoid side effects after this step
rm(count_steps_per_day,mean_steps_per_day, median_steps_per_day)
```

These values check with those plotted in the histogram according to visual
inspection of the y-axis values.

## What is the average daily activity pattern?

The original data frame has time intervals of 5 seconds that span
24 hours (24*60/5=288 time markers) for 61 days (31 in October and 30 in November). 

```{r: daily activity pattern, cache=TRUE,echo=TRUE}
vector_of_seconds_per_day <- (0:287)*5
vector_seconds_for_61days <- rep(x=vector_of_seconds_per_day, times=61)

steps_per_interval<- tapply(X=clean_data$steps, 
                            vector_seconds_for_61days, 
                            FUN=mean,
                            na.rm=T,
                            simplify=TRUE)
```

```{r: plot activity pattern, cache=TRUE,echo=TRUE,fig.height=6}
plot(x=names(steps_per_interval),
     y=steps_per_interval,
     xlab="Daily intervals",
     ylab="steps",
     main="Activity pattern as steps per daily time interval",
     type="l",
     ylim=c(-5,205),
     pch=7,
     axes=FALSE)

## prepare labels  for x axis in this plot
lbls<- as.character(clean_data$interval[0:288])
insertColon <- function(l){
    nchars <- nchar(l)
    if( nchars < 2 ) {
        paste0("00:0",l)
    }
    else if ( nchars < 3 ) {
        paste0("00:", l)
    }
    else if( nchars < 4 ) {
        paste0("0", substr(l,1,1),":", substr(l,2,3) )
    }
    else if( nchars < 5 ) {
        paste0( substr(l,1,2), ":", substr(l,3,4))
    }
    else
        ""
}
prettylbls <- lapply(lbls,FUN=insertColon)

Axis(side=1,
     at=second_vector_per_day[c(1,25,50,75,100,125,150,175,200,225,250,275,288)],
     labels= prettylbls[c(1,25,50,75,100,125,150,175,200,225,250,275,288)],
     col='blue',
     col.ticks = 'red',
     col.axis = 'blue',
     tck = 0.03,
     xaxs="r")

Axis(side=3,
     at=second_vector_per_day[c(1,25,50,75,100,125,150,175,200,225,250,275,288)],
     labels= c("","","","","","","","","","","","",""),
     col = 'blue',
     col.ticks = 'red',
     col.axis = 'blue',
     las=2,
     tck = 1, # 100% of width or "grid lines on"
     lty= "dotted",
     xaxs="r")


Axis(side=2,
     at=c(0,50,100,150,200),
     labels= c("0","50","100", "150", "200"),
     col='blue',
     col.ticks = 'red',
     col.axis = 'blue',
     tck = 0.03,
     xaxs="r")

Axis(side=4,
     at=c(0,50,100,150,200),
     labels= c("","","", "", ""),     
     col = 'blue',
     col.ticks = 'red',
     col.axis = 'blue',
     las=2,
     tck = 1, # 100% of width or "grid lines on"
     lty= "dotted",
     xaxs="r")
```

Let's compute the values for the peak number of steps seen in the plot
occurring shortly after 8:15 on average during the two-month period of the
study.

```{r: max step interval, cache=TRUE, echo=TRUE }
max(steps_per_interval)
hour_of_day_for_max_steps <- floor(as.numeric(names(which.max(x=steps_per_interval)))/60)
minutes_of_day_for_max_steps <- as.numeric(names(which.max(x=steps_per_interval))) %% 60
```

The maximum average number of steps is `r max(steps_per_interval)` 
and occurs at time 
`r paste0( hour_of_day_for_max_steps,":", minutes_of_day_for_max_steps )` of the day on average.


## Imputing missing values

The number of days that contain `NA` can be computed with a table
over a logical vector testing for `NA` in the vector that
contains the count of the number of steps per day.

```{r: NA count, cache=TRUE,echo=TRUE}
count_steps_per_day <-tapply(X=clean_data$steps,INDEX=clean_data$date,sum)
table(is.na(count_steps_per_day))
```

There are 8 days that had `NA` data in them.

However the total number of actual `NA` readings can be computed with th following 
similar R code:

```{r: NA count steps total, cache=TRUE, echo=TRUE}
table(is.na(clean_data$steps))
```
So there are `r  table(is.na(clean_data$steps))[2][[1]]` `NA` entries in the `step`
column.

They can be filled in with the average number of steps per interval computed in the
previous step.

## Are there differences in activity patterns between weekdays and weekends?
